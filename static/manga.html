<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Manga</title>
	<style>
		:root {
			--bg: #0e0e10;
			--panel: #17171a;
			--text: #e6e6ea;
			--muted: #a0a0a8;
			--accent: #ff3d6e;
			--accent-2: #5cc8ff;
			--border: #2a2a30;
		}

		body {
			background: var(--bg);
			color: var(--text);
			font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial, sans-serif;
			margin: 0;
			padding: 0;
		}

		.container { max-width: 900px; margin: 0 auto; padding: 24px; }
		.panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
		header.site { position: sticky; top: 0; z-index: 10; background: linear-gradient(180deg, rgba(23, 23, 26, 0.95), rgba(23, 23, 26, 0.85)); backdrop-filter: blur(8px); border-bottom: 1px solid var(--border); }
		header.site .wrap { display: flex; align-items: center; justify-content: space-between; padding: 14px 24px; }
		.brand { display: flex; align-items: center; gap: 10px; font-weight: 800; }
		.brand .logo { width: 28px; height: 28px; border-radius: 6px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); display: inline-block; }
		.brand a { color: var(--text); text-decoration: none; font-size: 18px; }
		.manga-info { display: flex; gap: 20px; margin-bottom: 20px; }
		.cover img { width: 200px; height: auto; border-radius: 8px; object-fit: cover; }
		.info { flex: 1; display: flex; flex-direction: column; gap: 8px; }
		.info h1 { font-size: 28px; font-weight: 800; margin: 0; }
		.info .muted { color: var(--muted); font-size: 14px; }
		.info .meta { font-size: 14px; color: #c0c0c8; }
		.info .meta strong { color: var(--text); }
		#summary { font-size: 16px; line-height: 1.5; color: var(--text); margin-top: 12px; }
		.chapters-wrapper { padding: 16px; max-height: none; overflow-y: visible; }
		#altTitles { display: flex; flex-direction: column; gap: 4px; font-size: 14px; color: var(--muted); }
		#chapters.card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; }
		#chapters.row-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(30%, 1fr)); gap: 16px; }
		@media (max-width: 600px) { #chapters.row-grid { grid-template-columns: 1fr; } .manga-info { flex-direction: column; align-items: center; } .cover img { width: 150px; } .info h1 { font-size: 24px; } }
		.chapter-card { display: flex; flex-direction: column; border-radius: 12px; background: #121216; border: 1px solid var(--border); overflow: hidden; padding: 12px; }
		.row-grid .chapter-card { flex-direction: row; align-items: center; justify-content: space-between; gap: 12px; }
		.chapter-title { font-weight: 600; margin-bottom: 6px; }
		.chapter-date { font-size: 13px; color: var(--muted); }
		.read-btn { background: #22232a; color: var(--text); border: 1px solid var(--border); border-radius: 10px; padding: 8px 12px; font-weight: 600; cursor: pointer; transition: background 0.2s, color 0.2s; }
		.read-btn:hover { background: var(--accent); color: #fff; }
		#toggleChaptersViewBtn, #reverseChaptersBtn { padding: 10px 20px; border: none; border-radius: 12px; color: #fff; font-weight: bold; cursor: pointer; margin-bottom: 16px; transition: transform 0.2s, opacity 0.2s; }
		#toggleChaptersViewBtn { background: linear-gradient(135deg, var(--accent), var(--accent-2)); margin-right: 8px; }
		#toggleChaptersViewBtn:hover, #reverseChaptersBtn:hover { transform: scale(1.05); opacity: 0.9; }
		#reverseChaptersBtn { background: linear-gradient(135deg, #5cc8ff, #ff3d6e); margin-left: 8px; transition: transform 0.2s, opacity 0.2s, box-shadow 0.2s; }
		#reverseChaptersBtn:hover { box-shadow: 0 0 12px rgba(255, 61, 110, 0.6), 0 0 12px rgba(92, 200, 255, 0.6); }
	</style>
</head>

<body>
	<header class="site">
		<div class="wrap">
			<div class="brand"><span class="logo"></span><a href="/home">MangaReader</a></div>
		</div>
	</header>

	<div class="container">
		<div class="panel">
			<div class="manga-info">
				<div class="cover">
					<img id="coverImg" src="" alt="Cover image">
				</div>
				<div class="info">
					<h1 id="title">Loading...</h1>
					<p id="author" class="muted"></p>
					<div class="meta"><strong>Status:</strong> <span id="status"></span></div>
					<div class="meta"><strong>Rank:</strong> <span id="rank"></span></div>
					<div class="meta"><strong>Bookmarked:</strong> <span id="bookmarked"></span></div>
					<div class="meta"><strong>Genres:</strong> <span id="genres"></span></div>
					<div class="meta"><strong>Alternative Titles:</strong> <span id="altTitles"></span></div>
					<div class="meta"><strong>Source:</strong> <a id="sourceLink" target="_blank" rel="noopener noreferrer">Visit</a></div>
				</div>
			</div>
			<div id="summary">
				<strong>Summary:</strong>
				<p id="desc"></p>
			</div>
		</div>

		<h2 class="panel" style="padding:20px;">Chapters</h2>
		<div class="chapters-wrapper panel">
			<button id="toggleChaptersViewBtn">Switch to Row Grid</button>
			<button id="reverseChaptersBtn">Reverse Order</button>
			<div id="chapters" class="card-grid"></div>
		</div>
	</div>

	<script>
		// ====== Get slug from URL path ======
		const pathParts = window.location.pathname.split("/");
		const slug = pathParts[2]; // /manga/<slug>
		if (!slug) {
			document.querySelector('.container').innerHTML =
				'<p class="muted">Invalid manga URL.</p>';
		}

		// ====== DOM Elements ======
		const chaptersGrid = document.getElementById('chapters');
		const toggleBtn = document.getElementById('toggleChaptersViewBtn');
		const reverseBtn = document.getElementById('reverseChaptersBtn');

		// ====== State ======
		let isCardGrid = localStorage.getItem('chaptersView') !== 'row';
		let isReversed = false;
		let currentChapters = [];

		function applyView() {
			chaptersGrid.className = isCardGrid ? 'card-grid' : 'row-grid';
			toggleBtn.textContent = isCardGrid ? 'Switch to Row Grid' : 'Switch to Card Grid';
		}
		applyView();

		toggleBtn.addEventListener('click', () => {
			isCardGrid = !isCardGrid;
			applyView();
			localStorage.setItem('chaptersView', isCardGrid ? 'card' : 'row');
		});

		reverseBtn.addEventListener('click', () => {
			isReversed = !isReversed;
			renderChapters(currentChapters);
			reverseBtn.textContent = isReversed ? 'Normal Order' : 'Reverse Order';
		});

		function renderChapters(list) {
			currentChapters = list || [];
			const chaptersToRender = isReversed ? [...currentChapters].reverse() : currentChapters;

			chaptersGrid.innerHTML = chaptersToRender.map(c => `
		<div class="chapter-card">
			<div>
				<div class="chapter-title">Chapter: ${c.number}<br>Title: ${c.title || ''}</div>
				<div class="chapter-date">${c.release_date || ''}</div>
			</div>
			<br>
			<button class="read-btn" onclick="window.location.href='/manga/${slug}/chapter-${c.number}'">Read</button>
		</div>
		`).join('');
		}

		// ====== Load manga info from API ======
		fetch(`/api/manga/${slug}`)
			.then(r => r.ok ? r.json() : {})
			.then(data => {
				if (!data || !data.title) {
					document.querySelector('.container').innerHTML =
						'<p class="muted">Failed to load manga details.</p>';
					return;
				}

				document.getElementById('title').textContent = data.title;
				document.getElementById('author').textContent = data.author || '';
				document.getElementById('status').textContent = data.status || 'Unknown';
				document.getElementById('rank').textContent = data.rank || 'N/A';
				document.getElementById('bookmarked').textContent = data.bookmarked || 0;
				document.getElementById('genres').textContent = (data.genres || []).join(', ');
				document.getElementById('altTitles').innerHTML =
					(data.alternative_titles || []).map(t => `<span>${t}</span>`).join('');
				document.getElementById('desc').textContent = data.description || '';
				document.getElementById('coverImg').src = data.thumbnail || '';
				document.getElementById('coverImg').alt = data.title;

				const sourceDiv = document.getElementById('sourceLink').parentElement;
				if (data.url) {
					document.getElementById('sourceLink').href = data.url;
					sourceDiv.style.display = 'block';
				} else {
					sourceDiv.style.display = 'none';
				}

				currentChapters = data.chapters || [];
				renderChapters(currentChapters);
			})
			.catch(() => {
				document.querySelector('.container').innerHTML =
					'<p class="muted">Failed to load manga info.</p>';
			});
	</script>
</body>
</html>
