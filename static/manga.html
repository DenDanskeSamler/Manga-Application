<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Manga</title>
	<style>
		/* =============================
		   Manga Page Specific Styling
		   ============================= */
		body {
			background: #0e0e10;
			color: #e6e6ea;
			font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial, sans-serif;
			margin: 0;
		}

		.container {
			max-width: 900px;
			margin: 0 auto;
			padding: 24px;
		}

		header.site {
			position: sticky;
			top: 0;
			z-index: 10;
			background: linear-gradient(180deg, rgba(23, 23, 26, 0.95), rgba(23, 23, 26, 0.85));
			backdrop-filter: blur(8px);
			border-bottom: 1px solid #2a2a30;
		}

		header.site .wrap {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 14px 24px;
		}

		.brand {
			display: flex;
			align-items: center;
			gap: 10px;
			font-weight: 800;
		}

		.brand .logo {
			width: 28px;
			height: 28px;
			border-radius: 6px;
			background: linear-gradient(135deg, #ff3d6e, #5cc8ff);
			display: inline-block;
		}

		.brand a {
			color: #e6e6ea;
			text-decoration: none;
			font-size: 18px;
		}

		nav a,
		#currentUserName {
			color: #e6e6ea;
			text-decoration: none;
		}

		nav a:hover {
			color: #5cc8ff;
		}

		.panel {
			background: #17171a;
			border: 1px solid #2a2a30;
			border-radius: 12px;
			padding: 20px;
			margin-bottom: 20px;
		}

		/* Manga info */
		#title {
			font-size: 28px;
			font-weight: 800;
			text-align: center;
			margin-bottom: 6px;
		}

		#author {
			font-size: 14px;
			color: #a0a0a8;
			text-align: center;
			margin-bottom: 12px;
		}

		#desc {
			font-size: 16px;
			line-height: 1.5;
			text-align: center;
			color: #e6e6ea;
			margin-bottom: 16px;
		}

		/* Chapter buttons list */
		#chapters {
			display: flex;
			flex-direction: column;
			gap: 12px;
		}

		#chapters a {
			display: flex;
			justify-content: space-between; /* pushes title left, date right */
			align-items: center;
			text-decoration: none;
			color: #e6e6ea;
			background: #22232a;
			border: 1px solid #2a2a30;
			padding: 12px 16px;
			border-radius: 10px;
			font-weight: 600;
			transition: background 0.2s, color 0.2s;
		}

		#chapters a:hover {
			background: #ff3d6e;
			color: #fff;
		}

		/* Responsive tweaks */
		@media (max-width: 500px) {
			#title {
				font-size: 22px;
			}
			#desc {
				font-size: 14px;
			}
			#chapters a {
				font-size: 14px;
				padding: 10px 12px;
			}
		}
	</style>
</head>
<body>
	<header class="site">
		<div class="wrap">
			<div class="brand"><span class="logo"></span><a href="/home.html">MangaReader</a></div>
			<nav>
				<span id="currentUserName" class="muted"></span>
				<a href="#" id="logoutBtn">Logout</a>
			</nav>
		</div>
	</header>
	<div class="container">
		<div class="panel">
			<h1 id="title">Loading...</h1>
			<p class="muted" id="author"></p>
			<p id="desc"></p>
		</div>
		<h2>Chapters</h2>
		<div id="chapters" class="panel"></div>
	</div>

	<script>
		// Navbar info
		fetch('/me').then(r => r.ok ? r.json() : { username: null }).then(data => {
			const el = document.getElementById('currentUserName');
			if (data && data.username && el) el.textContent = data.username;
		}).catch(() => {});
		document.getElementById('logoutBtn').addEventListener('click', (e) => {
			e.preventDefault();
			window.location.href = '/logout';
		});

		// Load manga
		const params = new URLSearchParams(window.location.search);
		const slug = params.get('slug');
		fetch(`/api/manga/${slug}`).then(r => r.json()).then(data => {
			document.getElementById('title').textContent = data.title || 'Unknown';
			document.getElementById('desc').textContent = data.description || '';
			const chapters = data.chapters || [];
			document.getElementById('chapters').innerHTML = chapters.map(c => 
				`<a href="/chapter.html?slug=${slug}&file=${encodeURIComponent(c.file)}">
					<span>Chapter ${c.number}: ${c.title}</span>
					<span>${c.release_date || ''}</span>
				</a>`
			).join('');

		});
	</script>
</body>
</html>
